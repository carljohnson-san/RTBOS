local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")

local NoClip = false
local NoclipLoop

-- Function to enable/disable noclip
local function ToggleNoClip()
    NoClip = not NoClip
    
    if NoClip then
        print("NoClip: ON")
        NoclipLoop = RunService.Stepped:Connect(function()
            if Character and Character:FindFirstChild("Humanoid") then
                for _, part in pairs(Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        print("NoClip: OFF")
        if NoclipLoop then
            NoclipLoop:Disconnect()
        end
    end
end

-- Keybind (Press "N" to toggle)
UIS.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.N then
        ToggleNoClip()
    end
end)

-- Auto-reapply noclip if character respawns
LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    Humanoid = newChar:WaitForChild("Humanoid")
    
    if NoClip then
        ToggleNoClip() -- Turn off and on to reapply
        task.wait(0.5)
        ToggleNoClip()
    end
end)
