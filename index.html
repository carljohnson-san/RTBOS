<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RTB OS | Syndicate v11.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CORE VISUALS --- */
        :root {
            --accent: #ffd900; /* Default RTB Gold */
            --glass: rgba(18, 18, 20, 0.92);
            --border: rgba(255, 255, 255, 0.15);
            --shadow-win: 0 20px 60px rgba(0,0,0,0.7);
        }

        * { box-sizing: border-box; user-select: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        
        body {
            margin: 0; overflow: hidden; height: 100vh; width: 100vw; color: white;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
            transition: background 0.5s;
        }

        /* --- BOOT SCREEN --- */
        #boot-screen {
            position: fixed; inset: 0; background: #000; z-index: 99999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease-out;
        }
        .boot-logo { font-size: 60px; font-weight: 900; color: var(--accent); letter-spacing: 5px; margin-bottom: 20px; text-shadow: 0 0 20px var(--accent); animation: pulse 2s infinite; }
        .boot-bar-box { width: 300px; height: 4px; background: #222; border-radius: 2px; overflow: hidden; position: relative; }
        .boot-bar { width: 0%; height: 100%; background: var(--accent); box-shadow: 0 0 10px var(--accent); animation: loadOS 2.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .boot-text { margin-top: 15px; font-family: monospace; color: #666; font-size: 12px; }
        
        @keyframes loadOS { 0% { width: 0%; } 100% { width: 100%; } }
        @keyframes pulse { 0%, 100% { text-shadow: 0 0 20px var(--accent); } 50% { text-shadow: 0 0 5px var(--accent); } }

        /* --- TOP BAR --- */
        #topBar {
            position: fixed; top: 0; width: 100%; height: 32px;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex; align-items: center; padding: 0 15px; z-index: 10000;
            font-size: 13px; font-weight: 500;
        }
        .brand { color: var(--accent); margin-right: 20px; font-weight: 900; letter-spacing: 1px; }
        .sys-btn { margin-left: 10px; cursor: pointer; transition: 0.2s; color: #ccc; }
        .sys-btn:hover { color: white; text-shadow: 0 0 5px white; }

        /* --- DESKTOP --- */
        #desktop {
            padding: 50px 40px; display: grid; 
            grid-template-columns: repeat(auto-fill, 90px);
            grid-template-rows: repeat(auto-fill, 110px);
            gap: 10px; height: 100vh; position: relative; z-index: 1;
        }
        .app-icon {
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
            transition: 0.2s; border-radius: 8px; padding: 10px 0; color: #ddd;
        }
        .app-icon:hover { background: rgba(255, 255, 255, 0.1); color: white; transform: translateY(-2px); }
        .app-icon i { font-size: 36px; margin-bottom: 8px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.8)); }
        .app-icon span { font-size: 11px; text-shadow: 0 2px 4px black; text-align: center; }

        /* --- WINDOW SYSTEM --- */
        .window {
            position: absolute; background: var(--glass); backdrop-filter: blur(30px);
            border: 1px solid var(--border); border-radius: 8px;
            box-shadow: var(--shadow-win); display: none; flex-direction: column;
            overflow: hidden; min-width: 300px; min-height: 200px;
            animation: popIn 0.2s ease-out; resize: both;
        }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .win-header {
            height: 36px; background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex; align-items: center; padding: 0 10px; cursor: default;
        }
        .win-drag-area { flex: 1; height: 100%; display: flex; align-items: center; cursor: grab; }
        .win-drag-area:active { cursor: grabbing; }
        .win-controls { display: flex; gap: 8px; margin-right: 15px; }
        .win-btn { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; transition: 0.1s; }
        .win-btn:hover { filter: brightness(1.2); }
        .close-btn { background: #ff5f56; } .min-btn { background: #ffbd2e; } .max-btn { background: #27c93f; }
        .win-title { font-size: 12px; font-weight: 700; color: #ccc; pointer-events: none; }
        .win-body { flex: 1; overflow: auto; position: relative; color: #eee; }

        /* --- APP SPECIFIC --- */
        /* Common Iframe */
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        /* Browser */
        .browser-toolbar { background: #111; padding: 8px; display: flex; gap: 8px; align-items: center; border-bottom: 1px solid #333; }
        .url-bar { flex: 1; background: #222; border: 1px solid #333; color: #ccc; padding: 5px 12px; border-radius: 15px; font-size: 12px; outline: none; font-family: monospace; }
        
        /* Media */
        .media-player-ui { display: flex; flex-direction: column; height: 100%; background: #050505; }
        .album-art { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .album-art i { font-size: 100px; color: #222; z-index: 1; }
        .media-controls { height: 100px; background: #111; padding: 15px; border-top: 1px solid #333; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* Video */
        .video-container { width: 100%; height: 100%; background: black; display: flex; flex-direction: column; }
        .video-wrapper { flex: 1; position: relative; display:flex; align-items:center; justify-content:center; }
        video { width: 100%; height: 100%; outline: none; display: block; }
        .yt-frame { width: 100%; height: 100%; border: none; display: none; background: black; }
        .video-toolbar { background: #111; padding: 10px; display: flex; gap: 10px; border-top: 1px solid #333; }

        /* Settings */
        .color-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 20px; }
        .color-swatch { height: 50px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; }
        .color-swatch:hover { transform: scale(1.1); }

        /* Files */
        .file-sidebar-item { padding: 8px; cursor: pointer; font-size: 13px; color: #aaa; border-radius: 4px; }
        .file-sidebar-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .file-sidebar-item.active { background: var(--accent); color: black; font-weight: bold; }
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, 90px); gap: 15px; padding: 15px; }
        .file-item { text-align: center; cursor: pointer; color: #ddd; display:flex; flex-direction:column; align-items:center; }
        .file-item:hover { color: white; }
        .file-item i { font-size: 32px; margin-bottom: 8px; display: block; }
        .file-item span { font-size: 11px; line-height: 1.2; }

        /* Partners */
        .partner-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 15px; margin-bottom: 10px; border-radius: 6px; display: flex; align-items: center; gap: 15px; }
        
        /* --- DOCK --- */
        #dock-container { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; z-index: 11000; pointer-events: none; }
        #dock {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); padding: 8px 15px;
            border-radius: 20px; display: flex; gap: 20px; pointer-events: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); transition: 0.2s;
        }
        .dock-item {
            font-size: 28px; cursor: pointer; transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
        }
        .dock-item:hover { transform: scale(1.3) translateY(-15px); }
        .dock-tooltip {
            position: absolute; top: -40px; background: #222; padding: 4px 8px; border-radius: 4px; color: white;
            font-size: 10px; opacity: 0; pointer-events: none; transition: 0.2s; white-space: nowrap; border: 1px solid #444;
        }
        .dock-item:hover .dock-tooltip { opacity: 1; top: -50px; }
        
        /* Utility */
        .hidden-file-input { display: none; }
        .m-btn { background: none; border: none; color: white; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .m-btn:hover { color: var(--accent); }
    </style>
</head>
<body>

    <div id="boot-screen">
        <div class="boot-logo"><i class="fas fa-biohazard"></i> RTB</div>
        <div class="boot-bar-box"><div class="boot-bar"></div></div>
        <div class="boot-text" id="boot-text">Loading Kernel v11.0 (2026)...</div>
    </div>

    <div id="topBar">
        <div class="brand"><i class="fas fa-biohazard"></i> RTB OS</div>
        <div style="opacity:0.7; margin-right:20px; font-size:12px;">System</div>
        <div style="opacity:0.7; margin-right:20px; font-size:12px;">View</div>
        <div id="clock" style="margin-left:auto; font-family:monospace; color:var(--accent); margin-right: 20px;">00:00</div>
        
        <i class="fas fa-redo sys-btn" title="Restart System" onclick="location.reload()"></i>
        <i class="fas fa-power-off sys-btn" title="Power Off" onclick="shutdownOS()"></i>
    </div>

    <div id="desktop">
        <div class="app-icon" onclick="openApp('partners')">
            <i class="fas fa-users" style="color: #ff9d00;"></i>
            <span>Partners</span>
        </div>
        <div class="app-icon" onclick="openApp('files')">
            <i class="fas fa-folder-open" style="color: #ffd900;"></i>
            <span>Files</span>
        </div>
        <div class="app-icon" onclick="openApp('browser')">
            <i class="fas fa-globe" style="color: #4db8ff;"></i>
            <span>Nebula</span>
        </div>
        <div class="app-icon" onclick="openApp('code')">
            <i class="fas fa-laptop-code" style="color: #007acc;"></i>
            <span>Code Studio</span>
        </div>
        <div class="app-icon" onclick="openApp('settings')">
            <i class="fas fa-cog" style="color: #aaa;"></i>
            <span>Settings</span>
        </div>
        <div class="app-icon" onclick="window.open('https://carljohnson-san.github.io/RTB/')">
            <i class="fas fa-satellite-dish" style="color: #ff3333;"></i>
            <span>RTB Site</span>
        </div>
        <div class="app-icon" onclick="openApp('media')">
            <i class="fas fa-music" style="color: #ff33ff;"></i>
            <span>Sonic</span>
        </div>
        <div class="app-icon" onclick="openApp('video')">
            <i class="fas fa-film" style="color: #00ffcc;"></i>
            <span>Vision</span>
        </div>
        <div class="app-icon" onclick="openApp('terminal')">
            <i class="fas fa-terminal" style="color: #fff;"></i>
            <span>Terminal</span>
        </div>
    </div>

    <div class="window" id="win-settings" style="top:100px; left:600px; width:400px; height:300px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('settings')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-settings')">
                <div class="win-title">Settings</div>
            </div>
        </div>
        <div class="win-body" style="background:#111;">
            <h4 style="margin:15px 0 0 20px; color:#888;">System Accent Color</h4>
            <div class="color-grid">
                <div class="color-swatch" style="background:#ffd900" onclick="setTheme('#ffd900')"></div>
                <div class="color-swatch" style="background:#ff3333" onclick="setTheme('#ff3333')"></div>
                <div class="color-swatch" style="background:#00ffcc" onclick="setTheme('#00ffcc')"></div>
                <div class="color-swatch" style="background:#4db8ff" onclick="setTheme('#4db8ff')"></div>
                <div class="color-swatch" style="background:#ff33ff" onclick="setTheme('#ff33ff')"></div>
                <div class="color-swatch" style="background:#88ff00" onclick="setTheme('#88ff00')"></div>
                <div class="color-swatch" style="background:#ffffff" onclick="setTheme('#ffffff')"></div>
                <div class="color-swatch" style="background:#ff9d00" onclick="setTheme('#ff9d00')"></div>
            </div>
        </div>
    </div>

    <div class="window" id="win-files" style="top:150px; left:100px; width:650px; height:400px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('files')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-files')">
                <div class="win-title">File Explorer</div>
            </div>
        </div>
        <div class="win-body" style="display:flex;">
            <div style="width:140px; background:rgba(255,255,255,0.03); padding:10px; border-right:1px solid #333;">
                <div class="file-sidebar-item active" id="nav-home" onclick="navFiles('home')"><i class="fas fa-home"></i> Home</div>
                <div class="file-sidebar-item" id="nav-videos" onclick="navFiles('videos')"><i class="fas fa-video"></i> Videos</div>
                <div class="file-sidebar-item" onclick="alert('Access Denied: Encrypted Partition')"><i class="fas fa-lock"></i> Classified</div>
            </div>
            
            <div style="flex:1;">
                <div id="view-home" class="file-grid">
                    <div class="file-item"><i class="fas fa-file-alt" style="color:#aaa"></i><span>manifest.txt</span></div>
                    <div class="file-item"><i class="fas fa-cog" style="color:#aaa"></i><span>config.sys</span></div>
                </div>
                <div id="view-videos" class="file-grid" style="display:none;">
                    <div class="file-item" onclick="openYoutubeFile('f-1ZrkjkyrE')">
                        <i class="fab fa-youtube" style="color:red"></i>
                        <span>RTB vs Maldives I</span>
                    </div>
                    <div class="file-item" onclick="openYoutubeFile('MfJplAefXqw')">
                        <i class="fab fa-youtube" style="color:red"></i>
                        <span>RTB vs Maldives II</span>
                    </div>
                    <div class="file-item" onclick="openYoutubeFile('SSkpFnP8zsw')">
                        <i class="fab fa-youtube" style="color:red"></i>
                        <span>RTB vs Maldives Final</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="window" id="win-partners" style="top:150px; left:200px; width:450px; height:350px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('partners')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-partners')">
                <div class="win-title">Syndicate Partners</div>
            </div>
        </div>
        <div class="win-body" style="padding:20px;">
            <div class="partner-card">
                <i class="fas fa-user-astronaut" style="font-size:30px; color:var(--accent)"></i>
                <div>
                    <div style="font-weight:bold; font-size:16px;">monkey_kid03</div>
                    <div style="font-size:12px; opacity:0.7">Creator of Hagey's Trolling Union</div>
                </div>
            </div>
            <div class="partner-card">
                <i class="fas fa-code" style="font-size:30px; color:var(--accent)"></i>
                <div>
                    <div style="font-weight:bold; font-size:16px;">Aezhrin</div>
                    <div style="font-size:12px; opacity:0.7">Creator of Exefy</div>
                </div>
            </div>
            <div class="partner-card">
                <i class="fas fa-crosshairs" style="font-size:30px; color:var(--accent)"></i>
                <div>
                    <div style="font-weight:bold; font-size:16px;">Aimbotter</div>
                    <div style="font-size:12px; opacity:0.7">Creator of Void Hub</div>
                </div>
            </div>
        </div>
    </div>

    <div class="window" id="win-media" style="top:100px; left:300px; width:350px; height:450px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('media')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-media')">
                <div class="win-title">Sonic Player</div>
            </div>
        </div>
        <div class="win-body media-player-ui">
            <div class="album-art">
                <i class="fas fa-compact-disc" id="spinDisc"></i>
            </div>
            <div style="padding:0 15px; text-align:center; margin-bottom:5px;">
                <h4 id="trackName" style="margin:0; color:white;">No Track Loaded</h4>
            </div>
            <div class="media-controls">
                <div style="display:flex; justify-content:center; gap:20px; align-items:center;">
                    <button class="m-btn" onclick="document.getElementById('audioInput').click()"><i class="fas fa-folder-open"></i></button>
                    <button class="m-btn" onclick="togglePlay()"><i class="fas fa-backward"></i></button>
                    <button class="m-btn" onclick="togglePlay()" id="playPauseBtn" style="font-size:30px"><i class="fas fa-play"></i></button>
                    <button class="m-btn" onclick="togglePlay()"><i class="fas fa-forward"></i></button>
                </div>
            </div>
            <input type="file" id="audioInput" class="hidden-file-input" accept="audio/*" onchange="handleFileSelect(this, 'audio')">
            <audio id="mainAudio" onended="togglePlay()"></audio>
        </div>
    </div>

    <div class="window" id="win-video" style="top:120px; left:480px; width:600px; height:400px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('video')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-video')">
                <div class="win-title">Vision Player</div>
            </div>
        </div>
        <div class="win-body video-container">
            <div class="video-wrapper">
                <video id="mainVideo" controls style="display:block"></video>
                <iframe id="ytFrame" class="yt-frame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
            <div class="video-toolbar">
                <button class="m-btn" onclick="document.getElementById('videoInput').click()"><i class="fas fa-folder-open"></i> Open File</button>
                <button class="m-btn" onclick="loadVideoUrl()"><i class="fas fa-globe"></i> Open URL</button>
            </div>
            <input type="file" id="videoInput" class="hidden-file-input" accept="video/*" onchange="handleFileSelect(this, 'video')">
        </div>
    </div>

    <div class="window" id="win-code" style="top:50px; left:100px; width:900px; height:600px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('code')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-code')">
                <div class="win-title">Code Studio - vscode.dev</div>
            </div>
        </div>
        <div class="win-body" style="background:#1e1e1e; position:relative;">
            <div style="position:absolute; top:0; left:0; width:100%; padding:5px; background:#252526; text-align:center; font-size:11px; color:#888;">
                If content is blocked, <a href="https://vscode.dev" target="_blank" style="color:#007acc">Open Externally</a>
            </div>
            <iframe src="https://vscode.dev" style="width:100%; height:100%; border:none; padding-top:25px;"></iframe>
        </div>
    </div>

    <div class="window" id="win-terminal" style="top:300px; left:350px; width:550px; height:350px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('terminal')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-terminal')">
                <div class="win-title">root@rtb-shell</div>
            </div>
        </div>
        <div class="win-body" style="background:#0c0c0c; color:var(--accent); padding:10px; font-family:monospace; font-size:12px;" onclick="document.getElementById('termIn').focus()">
            <div id="termLog">
                RTB OS Kernel v11.0 [Onyx]<br>
                Copyright (c) 2026 Syndicate Corp.<br>
                Type 'help' for commands.<br>
            </div>
            <div style="display:flex; margin-top:5px;">
                <span style="color:white">root@rtb:~#&nbsp;</span>
                <input id="termIn" style="background:transparent; border:none; color:var(--accent); flex:1; outline:none; font-family:monospace;" autocomplete="off" onkeydown="termCmd(event)">
            </div>
        </div>
    </div>

    <div class="window" id="win-browser" style="top:50px; left:150px; width:800px; height:500px;">
        <div class="win-header">
            <div class="win-controls"><div class="win-btn close-btn" onclick="closeApp('browser')"></div></div>
            <div class="win-drag-area" onmousedown="startDrag(event, 'win-browser')">
                <div class="win-title">Nebula Browser</div>
            </div>
        </div>
        <div class="win-body" style="display:flex; flex-direction:column; height:100%;">
            <div class="browser-toolbar">
                <input class="url-bar" id="browserUrl" value="https://www.wikipedia.org" onkeydown="handleBrowserNav(event)">
                <i class="fas fa-search m-btn" onclick="navigateToUrl()"></i>
            </div>
            <iframe id="webFrame" src="https://www.wikipedia.org" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
        </div>
    </div>

    <div id="dock-container">
        <div id="dock">
            <div class="dock-item" onclick="openApp('files')" style="color:#ffd900"><i class="fas fa-folder"></i><span class="dock-tooltip">Files</span></div>
            <div class="dock-item" onclick="openApp('partners')" style="color:#ff9d00"><i class="fas fa-users"></i><span class="dock-tooltip">Partners</span></div>
            <div class="dock-item" onclick="openApp('browser')" style="color:#4db8ff"><i class="fas fa-globe"></i><span class="dock-tooltip">Nebula</span></div>
            <div class="dock-item" onclick="openApp('code')" style="color:#007acc"><i class="fas fa-code"></i><span class="dock-tooltip">Code</span></div>
            <div class="dock-item" onclick="openApp('media')" style="color:#ff33ff"><i class="fas fa-music"></i><span class="dock-tooltip">Sonic</span></div>
            <div class="dock-item" onclick="openApp('video')" style="color:#00ffcc"><i class="fas fa-film"></i><span class="dock-tooltip">Vision</span></div>
            <div class="dock-item" onclick="openApp('terminal')" style="color:#fff"><i class="fas fa-terminal"></i><span class="dock-tooltip">Terminal</span></div>
            <div class="dock-item" onclick="openApp('settings')" style="color:#aaa"><i class="fas fa-cog"></i><span class="dock-tooltip">Settings</span></div>
        </div>
    </div>

    <script>
        // --- BOOT ---
        window.onload = function() {
            const text = document.getElementById('boot-text');
            setTimeout(() => text.innerText = "Mounting 2026 Security Protocols...", 800);
            setTimeout(() => text.innerText = "Initializing Syndicate Database...", 1600);
            setTimeout(() => {
                document.getElementById('boot-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('boot-screen').style.display = 'none', 500);
            }, 2500);
            setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
        }

        // --- SYSTEM CORE ---
        let zIndex = 100;
        function openApp(id) {
            let win = document.getElementById('win-' + id);
            win.style.display = 'flex';
            bringToFront(win);
            if(!win.hasAttribute('data-opened')) {
                win.style.top = (60 + Math.random() * 40) + 'px';
                win.style.left = (80 + Math.random() * 80) + 'px';
                win.setAttribute('data-opened', 'true');
            }
        }
        function closeApp(id) {
            let win = document.getElementById('win-' + id);
            win.style.display = 'none';
            if(id === 'media') document.getElementById('mainAudio').pause();
            if(id === 'video') {
                document.getElementById('mainVideo').pause();
                document.getElementById('ytFrame').src = ""; // Stop Youtube
            }
        }
        function bringToFront(win) { win.style.zIndex = ++zIndex; }
        function shutdownOS() {
            document.body.innerHTML = "<div style='background:black; color:white; height:100vh; display:flex; align-items:center; justify-content:center; font-family:monospace'>System Halted. It is now safe to close this tab.</div>";
            alert("Powering Off... (You can close the tab now)");
            window.close(); 
        }

        // --- THEME ENGINE ---
        function setTheme(color) {
            document.documentElement.style.setProperty('--accent', color);
            document.documentElement.style.setProperty('--border', color + '44');
        }

        // --- DRAGGING ---
        function startDrag(e, winId) {
            let win = document.getElementById(winId);
            bringToFront(win);
            let shiftX = e.clientX - win.getBoundingClientRect().left;
            let shiftY = e.clientY - win.getBoundingClientRect().top;
            function moveAt(pageX, pageY) {
                win.style.left = pageX - shiftX + 'px';
                win.style.top = pageY - shiftY + 'px';
            }
            function onMouseMove(event) { moveAt(event.pageX, event.pageY); }
            document.addEventListener('mousemove', onMouseMove);
            document.onmouseup = function() {
                document.removeEventListener('mousemove', onMouseMove);
                document.onmouseup = null;
            };
        }

        // --- FILES APP ---
        function navFiles(view) {
            // Sidebar visual toggle
            document.querySelectorAll('.file-sidebar-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + view).classList.add('active');
            
            // Content toggle
            document.getElementById('view-home').style.display = 'none';
            document.getElementById('view-videos').style.display = 'none';
            document.getElementById('view-' + view).style.display = 'grid';
        }

        function openYoutubeFile(id) {
            // This function creates a seamless embed experience in Vision Player
            openApp('video');
            const video = document.getElementById('mainVideo');
            const iframe = document.getElementById('ytFrame');
            
            // Hide local video, show iframe
            video.style.display = 'none';
            video.pause();
            
            iframe.style.display = 'block';
            // Embed URL with autoplay
            iframe.src = "https://www.youtube.com/embed/" + id + "?autoplay=1&rel=0";
        }

        // --- MEDIA ---
        const audio = document.getElementById('mainAudio');
        function handleFileSelect(input, type) {
            const file = input.files[0];
            if (!file) return;
            const fileURL = URL.createObjectURL(file);
            if (type === 'audio') {
                audio.src = fileURL;
                document.getElementById('trackName').innerText = file.name;
                audio.play();
            } else if (type === 'video') {
                // Switch back to local video mode
                document.getElementById('ytFrame').style.display = 'none';
                document.getElementById('ytFrame').src = "";
                const vid = document.getElementById('mainVideo');
                vid.style.display = 'block';
                vid.src = fileURL;
                vid.play();
            }
        }
        function togglePlay() { audio.paused ? audio.play() : audio.pause(); }

        // --- VISION ---
        function loadVideoUrl() {
            let url = prompt("Enter URL (YouTube or Direct MP4):");
            if(!url) return;
            if(url.includes("youtube.com") || url.includes("youtu.be")) {
                // Extract ID logic
                let id = "";
                if(url.includes("v=")) id = url.split("v=")[1].split("&")[0];
                else if(url.includes("youtu.be/")) id = url.split("youtu.be/")[1];
                
                if(id) openYoutubeFile(id);
                else alert("Could not parse YouTube ID");
            } else {
                document.getElementById('ytFrame').style.display = 'none';
                document.getElementById('mainVideo').style.display = 'block';
                document.getElementById('mainVideo').src = url;
            }
        }

        // --- BROWSER ---
        function handleBrowserNav(e) { if(e.key === 'Enter') navigateToUrl(); }
        function navigateToUrl() {
            let url = document.getElementById('browserUrl').value;
            if(!url.startsWith('http')) url = 'https://' + url;
            document.getElementById('webFrame').src = url;
        }

        // --- TERMINAL ---
        function termCmd(e) {
            if(e.key === 'Enter') {
                let v = e.target.value.trim();
                let l = document.getElementById('termLog');
                l.innerHTML += `<br><span style="color:white">root@rtb:~#</span> ${v}`;
                
                if(v === 'help') l.innerHTML += "<br>Available: open, clear, reboot, date, sysinfo, scan";
                else if(v.startsWith('open ')) openApp(v.split(' ')[1]);
                else if(v === 'clear') l.innerHTML = "RTB OS Shell";
                else if(v === 'reboot') location.reload();
                else if(v === 'date') l.innerHTML += "<br>" + new Date().toString();
                else if(v === 'sysinfo') l.innerHTML += "<br>OS: RTB Syndicate v11.0<br>Kernel: Linux 6.8 (2026 Build)<br>Memory: 128GB / 128GB";
                else if(v === 'scan') l.innerHTML += "<br>Scanning Network...<br>No threats detected.<br>Syndicate Connection: Secure.";
                else l.innerHTML += "<br>Command not found.";
                
                e.target.value = "";
                l.parentElement.scrollTop = l.scrollHeight;
            }
        }
        
        // Bring to front logic
        document.querySelectorAll('.window').forEach(w => w.addEventListener('mousedown', () => bringToFront(w)));
    </script>
</body>
</html>
